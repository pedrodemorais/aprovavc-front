<div class="edital-container" *ngIf=" provaId">

  <!-- TOPO DO CARD: t√≠tulo + bot√µes -->
  <section class="card formulario">

    <div class="card-topo">
      <h3>
        {{ editando ? 'Editar t√≥pico do edital' : 'Adicionar t√≥pico do edital' }}
        ‚Äì {{ provaNome || 'Prova' }}
      </h3>

      <div class="botoes-topo">
        <button
          type="button"
          class="btn btn-secondary"
          (click)="novo()">
          Novo
        </button>
        <button
          type="submit"
          class="btn btn-primary"
          (click)="salvar()">
          {{ editando ? 'Salvar altera√ß√µes' : 'Adicionar t√≥pico' }}
        </button>
      </div>
    </div>

    <form [formGroup]="form" (ngSubmit)="salvar()">
<div *ngIf="erroBackend" class="alert alert-danger mt-2">
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
      d="M12 9v2m0 4h.01M4.93 4.93a10 10 0 0114.14 14.14A10 10 0 014.93 4.93z" />
  </svg>
  {{ erroBackend }}
</div>

      <div class="form-row linha">

        <!-- N√≠vel -->
        <div class="col col-nivel">
          <label for="codigo">N√≠vel no edital</label>
          <input
            id="codigo"
            type="text"
            formControlName="codigo"
            placeholder="Ex.: 1, 1.1, 1.1.2">
          <div class="erro" *ngIf="codigo?.invalid && (codigo?.dirty || codigo?.touched)">
            <span *ngIf="codigo?.errors?.['required']">N√≠vel √© obrigat√≥rio.</span>
            <span *ngIf="codigo?.errors?.['pattern']">
              Use apenas n√∫meros e pontos. Ex.: 1, 1.1, 2.3.10
            </span>
          </div>
        </div>

        <!-- Descri√ß√£o -->
        <div class="col col-descricao">
          <label for="descricao">Descri√ß√£o do t√≥pico</label>
          <input
            id="descricao"
            type="text"
            formControlName="descricao"
            placeholder="Ex.: Aplica√ß√£o da lei penal no tempo (retroatividade, ultratividade, abolitio criminis)">
          <div class="erro" *ngIf="descricao?.invalid && (descricao?.dirty || descricao?.touched)">
            <span *ngIf="descricao?.errors?.['required']">Descri√ß√£o √© obrigat√≥ria.</span>
            <span *ngIf="descricao?.errors?.['maxlength']">M√°ximo de 400 caracteres.</span>
          </div>
        </div>

        <!-- Ativo -->
        <div class="col col-ativo">
          <label class="check-label">
            <input type="checkbox" formControlName="ativo">
            <span>Ativo</span>
          </label>
        </div>
      </div>

    </form>
  </section>

  <!-- LISTA -->
  <section class="card lista">
    <div class="lista-header">
      
      <span *ngIf="carregando">Carregando...</span>
    </div>

    <table *ngIf="topicos && topicos.length > 0; else vazio">
   <thead>
  <tr>
    <th style="width: 88%; text-align: left; padding-left: 16px;">
      T√≥pico do edital
    </th>
    <th style="width: 90px;">Status</th>
    <th style="width: 140px;">A√ß√µes</th>
  </tr>
</thead>
      <tbody>
        <tr *ngFor="let t of topicos">
          <td class="descricao-col">
            <span
              class="descricao-wrapper"
              [style.padding-left.px]="getIndentacao(t.codigo)">
              <span class="nivel-prefix" *ngIf="getNivel(t.codigo) > 1">‚îî‚îÄ </span>
              {{ t.codigo }} - {{ t.descricao }}
            </span>
          </td>
          <td>
            <span class="badge" [ngClass]="t.ativo ? 'badge-ativo' : 'badge-inativo'">
              {{ t.ativo ? 'Ativo' : 'Inativo' }}
            </span>
          </td>
     <td class="acoes">
  <button
    type="button"
    class="btn btn-sm btn-icon btn-secondary"
    title="Editar t√≥pico"
    (click)="editar(t)">
    ‚úèÔ∏è
  </button>

  <button
    type="button"
    class="btn btn-sm btn-icon btn-danger"
    title="Excluir t√≥pico"
    (click)="excluir(t)">
    üóë
  </button>
</td>

        </tr>
      </tbody>
    </table>

    <ng-template #vazio>
      <p class="nenhum">Nenhum t√≥pico cadastrado ainda para este edital.</p>
    </ng-template>
  </section>

</div>

<div *ngIf="!(provaId)">
  <p>Selecione uma prova para configurar o edital.</p>
</div>
